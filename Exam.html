<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Online Exam</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
        }

        /* Navbar styling */
        #navbar {
            display: flex;
            align-items: center;
            background-color: #2e07b9;
            padding: 10px;
            color: white;
            position: fixed;
            width: 100%;
            top: 0;
            left: 0;
            z-index: 1000;
            justify-content: space-between;
        }

        #navbar img {
            border-radius: 50%;
            margin-right: 10px;
        }

        #navbar h1 {
            margin: 0;
            font-size: 20px;
        }

        #navbar button {
            padding: 10px 20px;
            background-color: #458be6;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        #navbar button:hover {
            background-color: #2e07b9;
        }

        /* Main content styling */
        #main-content {
            margin-top: 60px;
            padding: 20px;
            display: flex;
            justify-content: space-between;
        }

        /* Quiz styling */
        #quiz {
            width: 70%;
            margin-right: 20px;
        }

        .quiz-container {
            background-color: white;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            overflow: hidden;
        }

        .quiz-header {
            padding: 15px;
            background-color: #f8f9fa;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .quiz-header h1 {
            margin: 0;
            color: #2e07b9;
        }

        .quiz-header .status {
            background-color: #2e07b9;
            color: white;
            border-radius: 50px;
            padding: 5px 15px;
        }

        .quiz-body {
            padding: 20px;
            color: #2e07b9;
        }

        .quiz-body h5 {
            margin: 0;
            display: inline;
        }

        .quiz-body .answer-option {
            display: block;
            margin: 5px 0;
        }

        .alert {
            display: none;
            color: #721c24;
            background-color: #f8d7da;
            border-color: #f5c6cb;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
        }

        .btn-danger {
            background-color: #dc3545;
            color: white;
        }

        .btn-success {
            background-color: #28a745;
            color: white;
        }

        .btn-danger:hover {
            background-color: #c82333;
        }

        .btn-success:hover {
            background-color: #218838;
        }

        .btn-submit, .btn-back, .btn-bookmark {
            background-color: #2e07b9;
            color: white;
            padding: 10px 20px;
            border-radius: 50px;
            margin: 5px;
        }

        .btn-submit:hover, .btn-back:hover, .btn-bookmark:hover {
            background-color: #1b1f9e;
        }

        .btn-back {
            background-color: #17a2b8;
        }

        .btn-back:hover {
            background-color: #138496;
        }

        .btn-bookmark {
            background-color: #ffc107;
        }

        .btn-bookmark:hover {
            background-color: #e0a800;
        }

        .bookmarked {
            background-color: #e0a800 !important;
            color: white;
        }

        /* Bookmarked questions styling */
        #bookmarked-questions {
            width: 25%;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px;
            background-color: white;
        }

        .bookmark-item {
            cursor: pointer;
            padding: 10px;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            margin-bottom: 5px;
        }

        .bookmark-item:hover {
            background-color: #f0f0f0;
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <div id="navbar">
        <div id="navbar-left">
            <img id="profilePicSmall" src="" width="40" height="40" alt="Profile Picture">
            <h1>Welcome, <span id="username"></span></h1>
        </div>
        <button onclick="logout()">Logout</button>
    </div>

    <!-- Main Content -->
    <div id="main-content">
<!-- Quiz Section -->
<section id="quiz">
    <div class="quiz-container">
        <div class="quiz-header">
            <h1 class="text-center">Quiz</h1>
            <span class="status">
                <span id="currentQuestion"></span> Of <span id="totalNumberOfQuestions"></span> Questions
            </span>
        </div>

        <div class="quiz-body">
            <h5 class="d-inline">Q: </h5>
            <h5 id="question" class="d-inline"></h5>
            <div id="rowAnswer"></div>
            <div id="alert" class="alert alert-danger mt-3">Please Choose Your Answer</div>
            <button class="btn-bookmark" id="bookmark">Bookmark</button>
            <button class="btn-back" id="back">Back</button>
            <button class="btn-submit" id="next">Next</button>
            <button class="btn-submit" id="submit">Submit</button>
        </div>
        
        <!-- Results Section -->
        <div id="results" style="display: none;">
            <h2>Quiz Results</h2>
            <div id="results-container"></div>
        </div>
    </div>
</section>

        <!-- Bookmarked Questions Section -->
        <section id="bookmarked-questions">
            <h2>Bookmarked Questions</h2>
            <div id="bookmarks-container"></div>
        </section>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Check if user is logged in
            if (localStorage.getItem('isLoggedIn') !== 'true') {
                window.location.href = 'login.html';
            }
    
            // Update profile picture and username
            document.querySelector('#username').textContent = localStorage.getItem('username');
            document.querySelector('#profilePicSmall').src = localStorage.getItem('picture');
    
            // Fetch and display questions
            fetch('questions.json')
                .then(response => response.json())
                .then(data => {
                    let currentQuestionIndex = 0;
                    let bookmarkedQuestions = new Set();
                    let selectedAnswers = {};  // Object to store selected answers
                    let questions = data.sort(() => 0.5 - Math.random()).slice(0, 10);
                    let correctAnswers = questions.reduce((acc, question, index) => {
                        // Use the 'answer' property from the JSON data
                        if (question.answer !== undefined) {
                            acc[index] = question.answer; // Map question index to correct answer
                        } else {
                            console.error(`Question at index ${index} does not have an answer property`);
                        }
                        return acc;
                    }, {}); // Object to store correct answers by index
    
                    function showQuestion(index) {
                        const question = questions[index];
                        document.getElementById('question').textContent = question.question;
                        const rowAnswer = document.getElementById('rowAnswer');
                        rowAnswer.innerHTML = '';
    
                        question.options.forEach(option => {
                            const optionHtml = `
                                <div class="answer-option">
                                    <input type="radio" name="answer" value="${option}" id="option-${index}-${option}"
                                    ${selectedAnswers[index] === option ? 'checked' : ''}>
                                    <label for="option-${index}-${option}">${option}</label>
                                </div>
                            `;
                            rowAnswer.innerHTML += optionHtml;
                        });
    
                        document.getElementById('currentQuestion').textContent = index + 1;
                        document.getElementById('totalNumberOfQuestions').textContent = questions.length;
                        document.getElementById('alert').style.display = 'none'; // Hide alert
    
                        // Update bookmark button
                        const bookmarkBtn = document.getElementById('bookmark');
                        if (bookmarkedQuestions.has(index)) {
                            bookmarkBtn.classList.add('bookmarked');
                            bookmarkBtn.textContent = 'Unbookmark';
                        } else {
                            bookmarkBtn.classList.remove('bookmarked');
                            bookmarkBtn.textContent = 'Bookmark';
                        }
    
                        // Disable/Enable buttons based on current question
                        document.getElementById('back').disabled = index === 0;
                        document.getElementById('next').disabled = index === questions.length - 1;
                        document.getElementById('submit').style.display = index === questions.length - 1 ? 'inline-block' : 'none';
                    }
    
                    function handleNextQuestion() {
                        const selectedOption = document.querySelector('input[name="answer"]:checked');
                        
                        // Save the selected answer if any
                        if (selectedOption) {
                            const answer = selectedOption.value;
                            selectedAnswers[currentQuestionIndex] = answer;
                        } else {
                            // Automatically add to bookmarks if no answer is selected
                            bookmarkedQuestions.add(currentQuestionIndex);
                            updateBookmarkedQuestions();
                        }
                    
                        if (currentQuestionIndex === questions.length - 1) {
                            // Check if there are any unanswered questions
                            const unansweredQuestions = questions.map((_, index) => index).filter(index => !selectedAnswers.hasOwnProperty(index));
                            
                            if (unansweredQuestions.length > 0) {
                                // Navigate to the first unanswered question
                                currentQuestionIndex = unansweredQuestions[0];
                                showQuestion(currentQuestionIndex);
                            } else if (bookmarkedQuestions.size > 0) {
                                // Navigate to the first bookmarked question
                                currentQuestionIndex = [...bookmarkedQuestions][0];
                                showQuestion(currentQuestionIndex);
                            } else {
                                // End of quiz; show the result
                                showResult();
                            }
                        } else {
                            currentQuestionIndex++;
                            showQuestion(currentQuestionIndex);
                        }
                    }
                    
                    
    
                    function handleBackQuestion() {
                        if (currentQuestionIndex > 0) {
                            currentQuestionIndex--;
                            showQuestion(currentQuestionIndex);
                        }
                    }
    
                    function updateBookmarkedQuestions() {
                        const bookmarksContainer = document.getElementById('bookmarks-container');
                        bookmarksContainer.innerHTML = '';
    
                        bookmarkedQuestions.forEach(index => {
                            const question = questions[index];
                            const bookmarkItem = document.createElement('div');
                            bookmarkItem.className = 'bookmark-item';
                            bookmarkItem.textContent = `Q: ${question.question}`;
                            bookmarkItem.onclick = () => {
                                currentQuestionIndex = index;
                                showQuestion(index);
                            };
                            bookmarksContainer.appendChild(bookmarkItem);
                        });
                    }
    
                    function calculateScore() {
                        let score = 0;
                        questions.forEach((question, index) => {
                            if (selectedAnswers[index] === correctAnswers[index]) {
                                score++;
                            }
                        });
                        return score;
                    }
    
                    function showResult() {
                        // Save answer for the last question if it's not already saved
                         const selectedOption = document.querySelector('input[name="answer"]:checked');
    if (selectedOption) {
        const answer = selectedOption.value;
        selectedAnswers[currentQuestionIndex] = answer;
    }
    
                        
                        // Confirm with the user before submitting
                        const confirmSubmit = confirm('Are you sure you want to submit? This will finalize your answers.');
                        if (confirmSubmit) {
                            const score = calculateScore();
                            let message;
                            
                            if (score === questions.length) {
                                const messages = [
                                    'Bravo! You aced the quiz. Either you’re a prodigy or you’ve been secretly feeding answers to your brain. Either way, you’ve left us mere mortals in the dust!',
                                    'Perfect score! Either your brain is on overdrive, or you’ve hacked the quiz. Either way, congratulations on being a quiz overlord!',
                                    'Congratulations! You got them all right. Are you sure you’re not a cyborg? If you are, you’ve fooled us all with your human charm!',
                                    'You’ve achieved a perfect score! Are you sure you’re not using some form of advanced mind control? Either way, hats off to you!',
                                    'Well, well, well, look who’s the genius! You nailed every question. Either you’re superhuman or you’ve been spending too much time in the quiz lab!'
                                ];
                                message = messages[Math.floor(Math.random() * messages.length)];
                            } else if (score >= questions.length / 2) {
                                const messages = [
                                    'Nice job! You did better than most, but let’s face it, your brain was still a little sluggish. It’s like it’s been running on caffeine and fumes!',
                                    'Good effort! Your brain was definitely working, though it might need a bit of a tune-up. Keep at it before it starts rusting!',
                                    'Well done! You’ve survived the quiz with flying colors, but your brain might need a bit of a jump-start to reach full power next time!',
                                    'Great work! You managed to get a solid score. Just remember, even the best need a little oiling now and then!',
                                    'You did pretty well! Your brain was in gear, but it could use a bit of a polish. Keep at it, and you’ll be unstoppable!'
                                ];
                                message = messages[Math.floor(Math.random() * messages.length)];
                            } else if (score > 0) {
                                const messages = [
                                    'Not bad! Your score is average, which means your brain was operating at half-power. Maybe it was too busy thinking about lunch?',
                                    'You did okay. It seems like your brain was running on autopilot. Don’t worry; even the best need a break sometimes!',
                                    'You’ve got a middle-of-the-road score. Looks like your brain was somewhat engaged, but maybe it was too busy daydreaming about other things!',
                                    'Decent effort! Your brain was somewhat active, but maybe it’s time to give it a little more fuel for the next quiz!',
                                    'You’re in the average zone! Your brain did its best, but it might need a little more warm-up next time!'
                                ];
                                message = messages[Math.floor(Math.random() * messages.length)];
                            } else {
                                const messages = [
                                    'Zero points! Looks like your brain was off on a sabbatical. Time to give it a wake-up call and maybe find where it went missing!',
                                    'Oops! All answers wrong. It seems your brain was on vacation in a parallel universe. Time to give it a map back to reality!',
                                    'Well, that was a spectacular failure. Your brain might have been on strike. Better send it a memo about the importance of quizzes!',
                                    'Not a single point! It’s like your brain decided to take a nap during the quiz. Try setting an alarm for the next one!',
                                    'Failure on all fronts! Maybe your brain was too busy pondering the meaning of life. Time to refocus and try again!'
                                ];
                                message = messages[Math.floor(Math.random() * messages.length)];
                            }
                            
                            // Redirect to the score page with query parameters
                            window.location.href = `scorepage.html?score=${score}&message=${encodeURIComponent(message)}`;
                        }
                    }
    
                    document.getElementById('next').addEventListener('click', handleNextQuestion);
                    document.getElementById('back').addEventListener('click', handleBackQuestion);
                    document.getElementById('bookmark').addEventListener('click', function () {
                        if (bookmarkedQuestions.has(currentQuestionIndex)) {
                            bookmarkedQuestions.delete(currentQuestionIndex);
                            this.textContent = 'Bookmark';
                            this.classList.remove('bookmarked');
                        } else {
                            bookmarkedQuestions.add(currentQuestionIndex);
                            this.textContent = 'Unbookmark';
                            this.classList.add('bookmarked');
                        }
                        updateBookmarkedQuestions();
                    });
                    document.getElementById('submit').addEventListener('click', showResult);
    
                    // Initialize
                    showQuestion(currentQuestionIndex);
                })
                .catch(error => {
                    console.error('Error fetching questions:', error);
                });
        });
    </script>
    
</body>
</html>
